ARGUMENT XARG,YARG,ZARG;

//Длины базисных векторов исследуемой сцены:
//x=12
//y=37,5
//z=12

//Координаты центра исследуемой сцены:
//x=0
//y=0
//z=140


CONSTANT PI=3.1415926536;
CONSTANT H=70, OH=5, AL=PI/4, KKMAX=2;
CONSTANT X1=-9, Y1=-2, X2=0, Y2=2, X3=9, Y3=-2;
CONSTANT XM=(X1+X3)/2;
CONSTANT YM=(Y1+Y3)/2;
CONSTANT XD=X3-X1, YD=Y3-Y1;
CONSTANT XYD=SQRT(XD*XD+YD*YD);
CONSTANT A1=X1-X2, B1=Y1-Y2, C1=(X1*X1-X2*X2)+(Y1*Y1-Y2*Y2);
CONSTANT A2=X1-X3, B2=Y1-Y3, C2=(X1*X1-X3*X3)+(Y1*Y1-Y3*Y3);
CONSTANT D=4*(A1*B2-B1*A2), DA=2*(B2*C1-C2*B1), DB=2*(A1*C2-C1*A2);
CONSTANT A=DA/D, B=DB/D;
CONSTANT R2=(X1-A)*(X1-A)+(Y1-B)*(Y1-B);
CONSTANT R0=SQRT(R2);
CONSTANT L10=-1/(X1-A), L20=1/(Y1-B), L30=-1/(X3-A), L40=1/(Y3-B);
CONSTANT DL1=X1-A, DL2=Y1-B, DL3=X3-A, DL4=Y3-B;

CONSTANT L1=L10*((L10*DL3+L20*DL4)/ABS(L10*DL3+L20*DL4));
CONSTANT L2=L20*((L10*DL3+L20*DL4)/ABS(L10*DL3+L20*DL4));
CONSTANT L3=L30*((L30*DL1+L40*DL2)/ABS(L30*DL1+L40*DL2));
CONSTANT L4=L40*((L30*DL1+L40*DL2)/ABS(L30*DL1+L40*DL2));

//CONSTANT L1=L10*(L10*DL3+L20*DL4<0?-1:1);
//CONSTANT L2=L20*(L10*DL3+L20*DL4<0?-1:1);
//CONSTANT L3=L30*(L30*DL1+L40*DL2<0?-1:1);
//CONSTANT L4=L40*(L30*DL1+L40*DL2<0?-1:1);

CONSTANT NGPL1=SQRT(L1*L1+L2*L2), NGPL2=SQRT(L3*L3+L3*L3);
CONSTANT PAR1=100, PAR2=2, PAR=500, DX=-1, DY=0;
CONSTANT XCH1=-6, YCH1=0.25, ACH1=2, BCH1=1;
CONSTANT XCH2=0.5, YCH2=1.75, ACH2=1, BCH2=1;

VARIABLE Z=YARG+(H-OH)/2;
//VARIABLE KK=(KKMAX,Z/H)*(KKMAX,Z/H);
VARIABLE KK=EXP((Z/H)*LN(KKMAX));
VARIABLE PHI=AL*(1-4/H/H*(Z-H/2)*(Z-H/2));
VARIABLE X=XARG;
VARIABLE Y=ZARG;
VARIABLE XL=KK*(X*COS(PHI)+Y*SIN(PHI))+DX;
VARIABLE YL=KK*(Y*COS(PHI)-X*SIN(PHI))+DY;
VARIABLE XC=XL-A;
VARIABLE YC=YL-B;
VARIABLE PL1=(XC*L1+YC*L2)/NGPL1;
VARIABLE PL2=(XC*L3+YC*L4)/NGPL2;
VARIABLE CLI=PL1+PL2-SQRT(PL1*PL1+PL2*PL2);
VARIABLE WD=(R2-XC*XC-YC*YC)/2/R0;
VARIABLE WD2=WD*WD;
VARIABLE TW=(SQRT(WD2*WD2+CLI*CLI)-CLI)/2;
VARIABLE KAR=SQRT(TW*TW+WD2);
VARIABLE XPC=((XL-XM)*XD+(YL-YM)*YD)/XYD;
VARIABLE TT=(XYD/2+PAR1+XPC)*(XYD/2+PAR2-XPC)/PAR;
VARIABLE WL=-KAR+TT;
VARIABLE CH1=1-(XL-XCH1)*(XL-XCH1)/ACH1/ACH1-(YL-YCH1)*(YL-YCH1)/BCH1/BCH1;
VARIABLE CH2=1-(XL-XCH2)*(XL-XCH2)/ACH2/ACH2-(YL-YCH2)*(YL-YCH2)/BCH2/BCH2;
VARIABLE CH=CH1+CH2+SQRT(CH1*CH1+CH2*CH2);
VARIABLE W=WL-CH-SQRT(WL*WL+CH*CH);
VARIABLE W1=Z;
VARIABLE W2=W+W1-SQRT(W*W+W1*W1);
VARIABLE W3=(144-X*X-Y*Y)/24;
VARIABLE W4=-Z;
VARIABLE W5=W3+W4-SQRT(W3*W3+W4*W4);
VARIABLE W6=W2+W5+SQRT(W2*W2+W5*W5);
VARIABLE W7=(H-Z)*(Z+OH)/(H+OH);
VARIABLE W8=W6+W7-SQRT(W6*W6+W7*W7);
RETURN W8;
